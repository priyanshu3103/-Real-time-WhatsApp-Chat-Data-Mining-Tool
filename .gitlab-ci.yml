image: python:latest
services:
  - docker:latest

stages:
  - build
  - deploy

before_script:
  - apt-get update
  - apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
  - apt-get update
  - apt-get install docker.io -y 
  - docker --version
  - service docker start

build-app:
  stage: build
  script:
    - echo "Building app........"
    - docker build -t priyanshu1979/pipeline:01 .

deploy-app:
  stage: deploy
  script:
    - echo "Deploy app......."
    - docker run -d -p 8501:8501 --name myapp  priyanshu1979/pipeline:01
 
  only:
    - main